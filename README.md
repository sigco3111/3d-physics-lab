# 3D 물리 실험실 (3D Physics Lab)

## 🌟 프로젝트 개요

3D 물리 실험실은 사용자가 다양한 3D 객체를 만들고, 물리적 속성을 조정하며, 실시간으로 시뮬레이션 결과를 관찰할 수 있는 대화형 웹 애플리케이션입니다. Google Gemini API를 활용하여 자연어 프롬프트를 통해 복잡한 장면을 자동으로 생성하는 기능을 제공합니다. React, Three.js, Cannon.js를 주요 기술로 사용합니다.

실행 주소 : https://dev-canvas-pi.vercel.app/

## ✨ 주요 기능

-   **⚛️ 객체 생성 및 조작:**
    -   다양한 기본 도형(구, 상자, 원통, 원뿔, 캡슐, 토러스) 추가.
    -   객체의 위치, 회전, 크기, 색상 등 시각적 속성 편집.
    -   질량, 마찰계수, 반발계수, 초기 속도/각속도 등 물리적 속성 상세 편집.
    -   PBR 재질 속성(금속성, 거칠기) 편집.
    -   Gizmo 도구(이동, 회전)를 사용한 직관적인 객체 조작 (단축키: `T`, `R`).
-   **⚙️ 물리 시뮬레이션:**
    -   실시간 물리 시뮬레이션 (재생, 일시정지, 현재 상태 초기화).
    -   전체 장면 초기화 (모든 객체 삭제).
    -   전역 물리 설정: 중력 방향 및 크기, 시뮬레이션 속도 조절.
    -   객체에 충격량(순간적인 힘) 적용 기능.
-   **🔗 제약 조건 (Constraints):**
    -   객체 간의 다양한 물리적 연결 생성 및 편집.
    -   지원되는 제약 종류: 점대점(Point-to-Point), 힌지(Hinge), 고정(Lock), 거리(Distance).
    -   각 제약 조건의 로컬 피벗, 축(힌지), 목표 거리(거리) 등 설정 가능.
-   **🧠 AI 기반 장면 생성:**
    -   Google Gemini API를 사용하여 자연어 프롬프트로부터 3D 장면 자동 생성.
    -   예: "테이블 위에 사과 세 개와 책 한 권을 놓아줘."
    -   생성된 객체의 종류, 위치, 속성 및 제약 조건까지 AI가 제안.
-   **🔑 API 키 관리:**
    -   사용자가 직접 Gemini API 키를 입력하고 브라우저의 `localStorage`에 안전하게 저장.
    -   빌드 시점에 환경 변수(`process.env.API_KEY`)로 시스템 기본 키 설정 가능.
    -   API 키 상태(사용자 키, 시스템 키, 설정 필요) UI 표시.
    -   API 키가 없으면 AI 관련 기능은 비활성화되나, 다른 모든 기능은 정상 작동.
-   **📚 장면 라이브러리:**
    -   현재 작업 중인 장면을 이름과 함께 저장.
    -   저장된 장면 목록에서 불러오기, 이름 변경, 현재 상태로 덮어쓰기, 삭제.
    -   전체 라이브러리를 JSON 파일로 내보내기 및 가져오기 기능.
    -   애플리케이션 최초 실행 시 `public/physics_lab_scenes.json` 파일에서 기본 장면 라이브러리 자동 로드.
-   **⏪ 실행 취소/복구:**
    -   대부분의 편집 작업(객체 추가/수정/삭제, 제약 조건 추가/삭제 등)에 대한 다단계 실행 취소(`Ctrl+Z`) 및 복구(`Ctrl+Y`) 지원.
-   **📹 카메라 컨트롤:**
    -   사전 설정된 카메라 뷰(상단, 정면, 측면)로 빠르게 전환.
    -   특정 객체에 카메라 포커스 맞추기.
    -   마우스 조작: 왼쪽 클릭 드래그(회전), 오른쪽 클릭 드래그(이동/패닝), 휠(줌).
-   **📱 반응형 디자인:**
    -   데스크톱 및 모바일 환경에 최적화된 UI 레이아웃 제공.
    -   접이식 패널을 사용하여 공간 효율성 증대.
-   **❓ 도움말:**
    -   애플리케이션 사용법에 대한 상세 안내를 제공하는 인앱 도움말 모달.

## 🛠️ 기술 스택

-   **프론트엔드:** React (v19), TypeScript
-   **3D 렌더링:** Three.js (Module version)
-   **물리 엔진:** Cannon.js (CDN v0.6.2)
-   **AI 모델:** Google Gemini API (`@google/genai` SDK) - `gemini-2.5-flash-preview-04-17` 모델 사용
-   **스타일링:** Tailwind CSS (CDN)
-   **언어:** ES Modules 기반 최신 JavaScript

## 🚀 시작하기

1.  애플리케이션은 웹 브라우저에서 `index.html` 파일을 직접 열어 실행할 수 있도록 설계되었습니다. (별도의 빌드 과정이나 서버 실행이 필요 없는 정적 웹 페이지 구조)
2.  **Gemini API 키 설정 (AI 기능 사용 시):**
    -   AI 장면 생성 기능을 사용하려면 유효한 Google Gemini API 키가 필요합니다.
    -   **방법 1 (시스템 키):** 개발 환경에서 `process.env.API_KEY` 환경 변수에 API 키를 설정합니다. 이 키는 빌드 시점에 포함되어 시스템 기본 키로 사용됩니다.
    -   **방법 2 (사용자 입력):** 애플리케이션 왼쪽 패널 상단의 "Gemini API 키 관리" 섹션에서 직접 API 키를 입력하고 "저장" 버튼을 클릭합니다. 이 키는 브라우저의 `localStorage`에 저장되며, 시스템 키보다 우선적으로 사용됩니다. 빈 값을 저장하면 저장된 사용자 키가 삭제됩니다.
    -   API 키가 설정되지 않은 경우, AI 장면 생성 기능은 비활성화되며 관련 UI에 안내 메시지가 표시됩니다. 다른 모든 물리 시뮬레이션 기능은 API 키 없이 정상적으로 사용할 수 있습니다.

## 📁 파일 구조

주요 파일 및 디렉토리 구성은 다음과 같습니다:

```
.
├── public/
│   └── physics_lab_scenes.json  # 기본 장면 라이브러리 데이터
├── README.md                      # 본 파일
├── index.html                     # 메인 HTML 파일 (스크립트 및 CSS 로드)
├── index.tsx                      # React 애플리케이션 진입점
├── App.tsx                        # 루트 React 컴포넌트 (상태 관리 및 주요 로직)
├── components/                    # UI 컴포넌트 디렉토리
│   ├── icons/                     # SVG 아이콘 컴포넌트
│   ├── AIControls.tsx
│   ├── ApiKeyManager.tsx
│   ├── CameraControls.tsx
│   ├── CollapsiblePanel.tsx
│   ├── ConstraintEditor.tsx
│   ├── Controls.tsx
│   ├── GizmoControls.tsx
│   ├── GlobalSettingsPanel.tsx
│   ├── HelpModal.tsx
│   ├── ObjectPalette.tsx
│   ├── PhysicsCanvas.tsx
│   ├── PropertiesEditor.tsx
│   └── SceneLibraryPanel.tsx
├── hooks/                         # 커스텀 React Hooks
│   └── useCannonPhysics.ts        # Cannon.js 물리 로직 훅
├── ai/                            # AI 관련 서비스
│   └── geminiService.ts           # Gemini API 연동 로직
├── types.ts                       # TypeScript 타입 정의
└── metadata.json                  # 애플리케이션 메타데이터
```

## 📖 사용 가이드

1.  **객체 추가 및 선택:**
    -   왼쪽 패널의 "객체 추가" 섹션에서 원하는 모양의 버튼을 클릭하여 장면에 객체를 추가합니다.
    -   3D 캔버스에서 객체를 마우스로 클릭하여 선택합니다. 선택된 객체는 강조 표시되며, 오른쪽 "속성 편집기"에 해당 객체의 정보가 나타납니다.
2.  **속성 편집:**
    -   객체를 선택한 후, 오른쪽 "속성 편집기"에서 위치, 회전, 크기, 색상, 질량, 마찰계수, 반발계수 등 다양한 속성을 수정합니다. 변경 사항은 실시간으로 3D 캔버스 및 시뮬레이션에 반영됩니다 (시뮬레이션이 '중지' 상태일 때).
3.  **시뮬레이션 실행:**
    -   왼쪽 패널 하단의 컨트롤 버튼을 사용하여 시뮬레이션을 제어합니다:
        -   **시작:** 물리 시뮬레이션을 시작합니다.
        -   **일시정지:** 진행 중인 시뮬레이션을 일시 중지합니다.
        -   **초기화:** 시뮬레이션 상태를 객체들의 초기 설정(시작 전 상태)으로 되돌립니다.
        -   **장면 초기화(휴지통 아이콘):** 현재 장면의 모든 객체와 제약 조건을 삭제하고 빈 상태로 만듭니다.
4.  **AI 장면 생성:**
    -   먼저 "Gemini API 키 관리"에서 유효한 API 키를 설정합니다.
    -   "AI 장면 생성" 패널에서 만들고 싶은 장면에 대한 설명을 자연어로 입력합니다.
    -   "AI로 장면 생성" 버튼을 클릭합니다. AI가 프롬프트를 해석하여 관련 객체, 속성, 제약 조건으로 구성된 장면을 생성합니다. (기존 장면은 덮어쓰여집니다.)
5.  **장면 라이브러리 활용:**
    -   왼쪽 패널의 "장면 라이브러리" 버튼을 클릭하여 모달을 엽니다.
    -   **저장:** "새 장면 이름" 입력 필드에 이름을 입력하고 "저장" 버튼을 눌러 현재 장면을 라이브러리에 저장합니다.
    -   **불러오기:** 목록에서 원하는 장면의 "불러오기" 버튼을 클릭합니다.
    -   **내보내기/가져오기:** 라이브러리 전체를 JSON 파일로 백업하거나 다른 사용자와 공유할 수 있습니다.
6.  **제약 조건 사용:**
    -   "제약 조건 편집기"에서 "바디 A"와 "바디 B"로 연결할 두 객체를 선택합니다.
    -   각 객체 내에서의 연결 지점(로컬 피벗) 좌표를 설정합니다.
    -   원하는 제약 조건 타입(점대점, 힌지 등) 버튼을 클릭하여 추가합니다.
    -   생성된 제약 조건은 목록에 표시되며, 삭제할 수 있습니다.
7.  **조작 도구 (Gizmo) 사용:**
    -   객체를 선택한 상태에서, 왼쪽 패널 하단의 "이동" (단축키 `T`) 또는 "회전" (단축키 `R`) 버튼을 클릭하여 Gizmo를 활성화합니다.
    -   캔버스에 나타난 Gizmo 핸들을 드래그하여 객체를 직관적으로 조작합니다.
    -   Gizmo 사용은 시뮬레이션이 '중지' 또는 '일시정지' 상태일 때만 가능합니다.
    -   `Esc` 키로 Gizmo를 비활성화하거나 객체 선택을 해제할 수 있습니다.
8.  **단축키:**
    -   `T`: 이동 Gizmo 토글
    -   `R`: 회전 Gizmo 토글
    -   `Esc`: Gizmo 비활성화 / 객체 선택 해제
    -   `Ctrl + Z`: 실행 취소
    -   `Ctrl + Y`: 다시 실행

## 🤝 기여

현재 이 프로젝트는 개인 학습 및 데모 목적으로 개발되었습니다. 코드 개선 제안이나 버그 리포트는 언제나 환영합니다.

## 📄 라이선스

이 프로젝트는 별도의 라이선스가 명시되어 있지 않습니다. 학습 및 개인적 용도로 자유롭게 사용해주세요. (필요시 MIT 라이선스 등으로 변경 가능)
